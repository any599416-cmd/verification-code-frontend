<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证码同步</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 py-8">
    <div class="max-w-md mx-auto px-4">
        <div class="bg-white rounded-lg shadow p-6">
            <h1 class="text-xl font-bold text-center mb-6">验证码同步</h1>
            
            <div class="text-4xl font-bold text-center py-4 border rounded mb-4" id="code">----</div>
            <div class="text-right text-gray-500 text-sm mb-6" id="time">最后更新：无</div>
            
            <div class="flex gap-2">
                <button id="refresh" class="flex-1 bg-blue-500 text-white py-2 rounded">刷新</button>
                <button id="clear" class="flex-1 bg-gray-200 py-2 rounded">清空</button>
            </div>
            
            <div class="mt-4 text-center text-sm text-gray-500" id="status">同步中...</div>
        </div>
    </div>

    <script>
        const BACKEND_URL = "http://192.168.0.175:5000"; // 固定你的IP

        // 页面加载后立即请求
        document.addEventListener("DOMContentLoaded", () => {
            getCode();
            setInterval(getCode, 2000);
            document.getElementById("refresh").onclick = getCode;
            document.getElementById("clear").onclick = clearCode;
        });

        // 获取验证码（修复请求路径）
        function getCode() {
            fetch(BACKEND_URL + "/auto-get") // 直接拼接路径，避免斜杠问题
                .then(res => {
                    if (!res.ok) throw new Error("404错误");
                    return res.json();
                })
                .then(data => {
                    document.getElementById("code").textContent = data.code || "----";
                    document.getElementById("time").textContent = `最后更新：${data.update_time || "无"}`;
                    document.getElementById("status").textContent = "正常";
                })
                .catch(err => {
                    document.getElementById("status").textContent = "连接错误: " + err.message;
                });
        }

        function clearCode() {
            fetch(BACKEND_URL + "/clear", { method: "POST" }).then(getCode);
        }
    </script>
</body>
</html>